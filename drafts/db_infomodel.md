# Инфологическая модель
# Базы данных "Веб-тренажёр"

**Автор:** Довыденков В.Н.
**Дата:** 03.04.2025
**Версия:** 1.0

## Описание предметной области

Веб-тренажёр — это онлайн-сервис, помогающий изучать веб-интерфейс пользователям программ экранного доступа.
Веб-сайт, на котором шаг за шагом появляются всё более сложные элементы интерфейса: от простых текстов с заголовками и ссылкой "Далее" до страниц с графикой, выпадающими списками, встроенными объектами и формулами.

Каждая страница содержит описание, как найти эти элементы на веб-странице и как с ними взаимодействовать с помощью программы экранного доступа.

Существует дополнительная функциональность для преподавателей компьютерных курсов. После регистрации преподавателю доступно подключение и отслеживание прогресса связанных с ним учеников.

База данных предназначена для поддержки процессов веб-тренажёра: фиксации прогресса пользователя и взаимодействия преподавателя с учеником.

## Сущности и атрибуты

### Сущность "Пользователи (Users)"

- Идентификация происходит по уникальному ID в cookies или URL.
- При отсутствии идентификатора пользователь регистрируется автоматически.

**Атрибуты:**
- **Идентификатор (id):**
  Уникальный буквенно-цифровой идентификатор (8 символов); первичный ключ.
- **Имя (name):**
  Уникальный текст (имя, ФИО или псевдоним); задаётся преподавателем.
- **Идентификатор преподавателя (tutor_id):**
  Внешний ключ к "Преподаватели".
- **Зарегистрирован (registered_at):**
  Дата и время регистрации.

---

### Сущность "Преподаватели (Tutors)"

- Преподаватель регистрирует пользователей, задавая имя.
- Получает URL с идентификатором, который передаёт ученикам.
- Может отслеживать прогресс и отправлять текстовые подсказки.

**Атрибуты:**
- **Идентификатор (id):**
  Уникальный идентификатор; первичный ключ.
- **Имя (name):**
  Обязательный уникальный текстовый идентификатор.
- **Электронная почта (email):**
  Уникальный подтверждённый адрес.
- **Пароль (password_hash):**
  Хеш пароля.
- **Зарегистрирован (registered_at):**
  Дата и время регистрации.

---

### Сущность "Разделы (Topics)"

Хранит информацию о доступных разделах тренажёра.

**Атрибуты:**
- **Идентификатор (id):**
  Уникальный числовой идентификатор раздела; первичный ключ.
- **Название (title):**
  Название раздела:
    + Базовый
    + Мультимедиа
    + Математика

---

### Сущность "Этапы (Levels)"

- Этап — это выполнение пользователем задания.
- Имеет вес в баллах и принадлежит одному из разделов тренажёра.

**Атрибуты:**
- **Идентификатор (id):**
  Уникальный идентификатор; первичный ключ.
- **Название (title):**
  Название этапа.
- **Баллы (points):**
  Вес этапа в баллах (кратен 10).
- **Раздел (topic_id):**
  Внешний ключ к сущности "Разделы".

---

### Ассоциативная сущность "Пользователь_Этап (User_Level)"

- Связывает пользователей и этапы.
- Один этап для одного пользователя — один раз.

**Атрибуты:**
- **Идентификатор пользователя (user_id):**
  Внешний ключ к "Пользователи".
- **Идентификатор этапа (level_id):**
  Внешний ключ к "Этапы".
- **Дата и время завершения (completion_time):**
  Дата и время завершения этапа.
- **Идентификатор сессии (session_id):**
  Идентификатор сессии; внешний ключ.

---

### Сущность "Прогресс (Progress)"

- Хранит процент прогресса пользователя в каждом разделе.
- Обновляется при завершении этапа.

**Атрибуты:**
- **Идентификатор пользователя (user_id):**
  Внешний ключ к "Пользователи".
- **Идентификатор раздела (topic_id):**
  Внешний ключ к "Разделы".
- **Прогресс (completion_percentage):**
  Целое число от 0 до 100 (в процентах).

---

### Сущность "Сессии (Sessions)"

Фиксирует данные о визитах и действиях пользователя.

**Атрибуты:**
- **Идентификатор сессии (id):**
  Уникальный идентификатор.
- **Идентификатор пользователя (user_id):**
  Внешний ключ; необязательный.
- **Дата и время начала (start_time):**
  Начало сессии.
- **Дата и время завершения (end_time):**
  Завершение сессии.
- **IP-адрес (ip):**
  IP-адрес пользователя.
- **Тип устройства (device_type):**
  Тип устройства (например, мобильный телефон или настольный компьютер).
- **Браузер (browser):**
  Браузер пользователя.
- **Источник трафика (referrer):**
  URL, с которого пользователь **перешёл на сайт**.

---

### Сущность "Подсказки (Hints)"

- Позволяет преподавателю отправлять пользователю текстовые подсказки, отображаемые в интерфейсе тренажёра.
- Каждая подсказка привязана к преподавателю и пользователю.
- Сохраняется дата и время отправки, а также — при наличии — дата и время прочтения.
- Если атрибут `read_at` равен `NULL`, значит подсказка ещё не прочитана.

**Атрибуты:**
- **Идентификатор пользователя (user_id):**
  Внешний ключ к сущности "Пользователи (Users)".
- **Идентификатор преподавателя (tutor_id):**
  Внешний ключ к сущности "Преподаватели (Tutors)".
- **Текст подсказки (message):**
  Содержимое сообщения; текст произвольной длины (тип `text` в PostgreSQL).
- **Дата и время добавления (created_at):**
  Дата и время отправки подсказки.
- **Дата и время прочтения (read_at):**
  Дата и время прочтения пользователем; `NULL`, если подсказка ещё не была прочитана.

## Диаграммы связей (ERD)

@startuml
!define primaryKey(x) <b>x</b>
!define foreignKey(x) <i>x</i>

entity "Users" {
    primaryKey(id): string (8)
    name: string (unique)
    foreignKey(tutor_id): Tutors.id
    registered_at: datetime
}

entity "Tutors" {
    primaryKey(id): string
    name: string (unique, required)
    email: string (unique)
    password_hash: string
    registered_at: datetime
}

entity "Topics" {
    primaryKey(id): int
    title: string
}

entity "Levels" {
    primaryKey(id): string
    title: string
    points: int
    foreignKey(topic_id): Topics.id
}

entity "User_Level" {
    foreignKey(user_id): Users.id
    foreignKey(level_id): Levels.id
    completion_time: datetime
    foreignKey(session_id): Sessions.id
    primaryKey(user_id, level_id)
}

entity "Progress" {
    foreignKey(user_id): Users.id
    foreignKey(topic_id): Topics.id
    completion_percentage: int (0-100)
    primaryKey(user_id, topic_id)
}

entity "Sessions" {
    primaryKey(id): string
    foreignKey(user_id): Users.id
    start_time: datetime
    end_time: datetime
    ip: string
    device_type: string
    browser: string
    referrer: string
}

entity "Hints" {
    foreignKey(user_id): Users.id
    foreignKey(tutor_id): Tutors.id
    message: text
    created_at: datetime
    read_at: datetime?
    primaryKey(user_id, tutor_id, created_at)
}

' Связи
Users::tutor_id --> Tutors::id
Levels::topic_id --> Topics::id
User_Level::user_id --> Users::id
User_Level::level_id --> Levels::id
User_Level::session_id --> Sessions::id
Progress::user_id --> Users::id
Progress::topic_id --> Topics::id
Sessions::user_id --> Users::id
Hints::user_id --> Users::id
Hints::tutor_id --> Tutors::id
@enduml

